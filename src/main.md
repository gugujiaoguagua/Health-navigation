# 医疗出行助手 - 模块说明与开发计划

## 项目概述

医疗出行助手是一款基于AI智能推荐的医疗出行综合服务平台，为普通用户和患者提供症状分析分诊、就医行程规划、行程清单管理等一站式服务。

**核心功能**：
1. 症状描述 → 推荐医院科室（AI智能分诊）
2. 规划路线 + 住宿 + 吃饭（低/中/高三档）
3. 生成就医行程清单

**技术架构**：
- 前端：React Native + TypeScript + Redux Toolkit
- 后端：Node.js + Express.js + MongoDB
- AI：GLM-4.7（主模型） + MiniMax-M2.1（备用，自动切换）
- 地图：高德地图API
- 数据源：美团/携程酒店餐饮API

**当前仓库落地情况**：
- 已生成完整全链路文档（产品/架构/模块/工程/测试/审计/门禁/归档）
- 已落地最小可运行后端：`backend/`（登录鉴权/授权同意/分诊/选院/规划/清单全链路API）
- 已落地移动端：`mobile/`（登录→授权→分诊→选院→规划→清单闭环；支持Web预览与Expo Go）

## 本地运行

### 1) 启动后端

在 `backend/` 目录：
- 安装依赖：`npm install`
- 启动开发服务：`npm run dev`
- 健康检查：`GET http://localhost:3000/v1/health`

### 2) 启动移动端（Web）

在 `mobile/` 目录：
- 安装依赖：`npm install`
- 启动Web：`EXPO_PUBLIC_API_BASE_URL=http://localhost:3000 npm run web`
- 访问：`http://localhost:19006`

### 3) 启动移动端（真机/模拟器）

在 `mobile/` 目录：
- `npm run start`（用Expo Go扫码）
- Android：`npm run android`

说明：
- 真机上 `localhost` 指向手机自身；移动端会自动尝试使用Expo的局域网IP推导后端地址（默认端口3000）
- 也可手动指定：`EXPO_PUBLIC_API_BASE_URL=http://你的电脑局域网IP:3000`

### 环境变量（后端）

后端默认可在无Key情况下跑通（会走mock）。如需接入真实服务，配置：
- `GLM_API_KEY`、`GLM_BASE_URL`、`GLM_MODEL`
- `MINIMAX_API_KEY`、`MINIMAX_BASE_URL`、`MINIMAX_MODEL`
- `AMAP_KEY`（高德Web服务Key，用于地理编码/驾车路线）
- `AI_MODE=auto|mock`、`ROUTE_MODE=auto|mock`、`SMS_MODE=mock`
- `JWT_ACCESS_SECRET`、`JWT_ACCESS_EXPIRES_IN`（默认30m）

---

## 模块清单

### 基础架构组（并行开发）

#### M1: 用户认证与基础设施
| 属性 | 说明 |
|------|------|
| 功能 | 手机号注册登录、JWT认证、短信验证码、密码管理 |
| 依赖 | 无 |
| 预估工时 | 4人周 |
| 负责 | 后端1人 + 前端1人 |
| 文件 | `modules_engineering_plan.json` - M1部分 |

#### M2: 基础设施
| 属性 | 说明 |
|------|------|
| 功能 | 项目框架搭建、数据库配置、第三方服务集成 |
| 依赖 | M1 |
| 预估工时 | 3人周 |
| 负责 | 后端1人 |
| 文件 | `modules_engineering_plan.json` - M2部分 |

### 核心功能组（并行开发）

#### M3: AI服务集成与症状分析
| 属性 | 说明 |
|------|------|
| 功能 | GLM-4.7集成、MiniMax-M2.1备用、症状分析、智能分诊 |
| 依赖 | M1, M2 |
| 预估工时 | 6人周 |
| 负责 | 后端1人 + 前端1人 + AI工程师0.5人 |
| 文件 | `modules_engineering_plan.json` - M3部分 |

#### M4: 医院数据管理
| 属性 | 说明 |
|------|------|
| 功能 | 医院CRUD、科室管理、搜索筛选、收藏功能 |
| 依赖 | M2 |
| 预估工时 | 5人周 |
| 负责 | 后端1人 + 前端1人 |
| 文件 | `modules_engineering_plan.json` - M4部分 |

#### M5: 行程规划引擎
| 属性 | 说明 |
|------|------|
| 功能 | 地址设置、日期选择、预算档位、高德地图路线规划 |
| 依赖 | M3, M4 |
| 预估工时 | 5人周 |
| 负责 | 后端1人 + 前端1人 |
| 文件 | `modules_engineering_plan.json` - M5部分 |

### 增值服务组（顺序开发）

#### M6: 住宿餐饮推荐模块
| 属性 | 说明 |
|------|------|
| 功能 | 集成美团/携程API，住宿+餐饮低/中/高三档推荐与费用预估 |
| 依赖 | M2, M5 |
| 预估工时 | 5.5人周 |
| 负责 | 后端1人 + 前端1人 |
| 文件 | `module_breakdown.json` - M6部分 / `modules_engineering_plan.json`相关章节 |

#### M7: 行程单管理模块
| 属性 | 说明 |
|------|------|
| 功能 | 行程创建/编辑/删除、状态流转、导出分享、历史记录 |
| 依赖 | M2, M5, M6 |
| 预估工时 | 5.5人周 |
| 负责 | 后端1人 + 前端1人 |
| 文件 | `module_breakdown.json` - M7部分 / `modules_engineering_plan.json`相关章节 |

#### M8: 行程清单生成模块
| 属性 | 说明 |
|------|------|
| 功能 | 就医物品清单生成、分类管理、完成状态、离线查看与同步 |
| 依赖 | M2, M7 |
| 预估工时 | 4人周 |
| 负责 | 前端1人 + 后端0.5人 |
| 文件 | `module_breakdown.json` - M8部分 / `modules_engineering_plan.json`相关章节 |

### 运营支撑组（并行开发）

#### M9: 用户中心模块
| 属性 | 说明 |
|------|------|
| 功能 | 我的页、历史记录、收藏管理、个人设置、帮助与反馈 |
| 依赖 | M1 |
| 预估工时 | 3人周 |
| 负责 | 前端1人 |
| 文件 | `module_breakdown.json` - M9部分 / `modules_engineering_plan.json`相关章节 |

#### M10: 消息通知模块
| 属性 | 说明 |
|------|------|
| 功能 | 行程提醒、系统消息、短信通知、消息中心与通知设置 |
| 依赖 | M1, M2, M7 |
| 预估工时 | 3.5人周 |
| 负责 | 后端1人 + 前端0.5人 |
| 文件 | `module_breakdown.json` - M10部分 / `modules_engineering_plan.json`相关章节 |

---

## 项目里程碑

| 阶段 | 时间 | 内容 | 交付物 |
|------|------|------|--------|
| 产品设计 | 第1-3周 | PRD、流程图、数据库设计、API文档、UI设计 | 完整设计文档 |
| 基础搭建 | 第4-6周 | 前后端框架、数据库配置、认证模块、地图SDK | 可运行项目框架 |
| 核心开发 | 第7-12周 | AI分析、医院管理、行程规划核心功能 | 核心功能可运行 |
| 完整开发 | 第13-18周 | 住宿餐饮集成、行程单管理、清单生成 | 完整功能联调 |
| 测试优化 | 第19-22周 | 系统测试、性能优化、安全审计 | 测试报告、优化报告 |
| 上线运营 | 第23-24周 | 生产部署、应用商店上架、监控配置 | 正式上线 |

**总周期**: 24周（6个月）  
**总工时**: 45人周  
**团队规模**: 4-5人

---

## 后续开发计划

### 第一阶段：阻塞问题修复（2-3周）

#### P0: 必须修复项

1. **数据加密加固**
   - 对MongoDB中敏感字段实施AES-256加密
   - 使用安全存储方案（React Native Keychain）
   - 实施密钥管理方案

2. **隐私政策完善**
   - 制定符合《个人信息保护法》的隐私政策
   - 实现敏感信息单独同意弹窗
   - 记录用户同意日志

3. **AI服务数据合规**
   - 与智谱AI、MiniMax签署数据处理协议（DPA）
   - 评估AI服务商数据存储位置
   - 完善数据删除机制

4. **Token安全升级**
   - 使用Keychain替代AsyncStorage存储Token
   - 设置合理的Token有效期
   - 实现自动刷新和异常检测

5. **医疗免责声明**
   - 在症状分析页面添加显著免责声明
   - 实现紧急症状预警机制
   - 建立用户反馈收集流程

### 第二阶段：合规提升（2周）

1. 完成个人信息安全影响评估
2. 建立数据安全管理制度
3. 完善用户权利响应机制（数据导出、账户注销）
4. 评估网络安全等级保护需求

### 第三阶段：安全加固（1-2周）

1. 完善安全监控和日志审计体系
2. 加强API安全控制（分布式限流）
3. 本地数据存储加密
4. 完善安全审计日志

---

## 风险与应对

| 风险 | 等级 | 应对措施 |
|------|------|----------|
| AI分诊误判 | 高 | 免责声明、紧急预警、用户反馈、医疗专业人员审核 |
| 第三方API依赖 | 高 | API抽象层、熔断模式、备用服务商、健康监控 |
| 数据安全合规 | 高 | 加密存储、隐私政策、DPA签署、合规审计 |
| 项目进度延迟 | 中 | 缓冲时间、并行开发、敏捷迭代、风险预警 |
| 跨平台兼容性 | 中 | 双平台测试、平台无关组件、适配代码 |

---

## 验收标准

### 功能验收（25项）

- [ ] 用户可通过文字或语音输入症状描述
- [ ] AI返回≥3个推荐科室选项
- [ ] 科室推荐准确率达到85%以上
- [ ] GLM-4.7达到限制时自动切换MiniMax-M2.1
- [ ] 支持低/中/高三档住宿选择
- [ ] 支持低/中/高三档餐饮选择
- [ ] 自动生成就医行程清单
- [ ] 行程清单支持导出和分享
- [ ] 用户数据加密存储和传输
- [ ] 符合中国网络安全法要求
- [ ] iOS和Android功能一致性≥95%
- [ ] 页面加载时间≤3秒
- [ ] API响应时间≤500ms

### 性能验收

- [ ] API接口测试通过率≥95%
- [ ] E2E测试通过率≥90%
- [ ] 单元测试覆盖率≥80%
- [ ] 支持1000+并发用户

### 安全验收

- [ ] 安全审计通过
- [ ] 无高危漏洞
- [ ] 数据泄露事件=0
- [ ] 安全合规审计通过率100%

---

## 文档清单

| 文档 | 文件 | 状态 |
|------|------|------|
| 产品与架构 | `product_architecture.json` | ✅ 完成 |
| 模块切分 | `module_breakdown.json` | ✅ 完成 |
| 工程方案 | `modules_engineering_plan.json` | ✅ 完成 |
| 模块实施补充 | `modules_implementation_plan.json` | ✅ 完成 |
| 测试计划 | `test_plan.json` | ✅ 完成 |
| 审计报告 | `security_audit_report.json` | ✅ 完成 |
| 门禁报告 | `门禁报告_20260123.json` | ✅ 完成 |
| 归档报告 | `项目归档报告.json` | ✅ 完成 |

---

## 当前状态

**门禁状态**: 不通过（需修复阻塞问题后重审）

**关键指标**:
- 合规符合度: 45%
- 安全评分: 50分
- 测试通过率: 92%

**下一步**:
1. 修复5项阻塞问题（2-3周）
2. 提交复测申请
3. 重新申请门禁审核

---

*文档版本: 1.0*  
*更新日期: 2026-01-23*  
*下次更新: 阻塞问题修复完成后*
